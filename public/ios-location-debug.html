<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS å®šä½é—®é¢˜è¯Šæ–­ - å¤©æ°”å°é¸­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .status-item:last-child {
            margin-bottom: 0;
        }
        
        .status-label {
            font-weight: 500;
            color: #555;
        }
        
        .status-value {
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 8px 4px;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .result-card.show {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .solution-card {
            background: #e8f4fd;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #007bff;
        }
        
        .solution-title {
            font-weight: 600;
            color: #0056b3;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .solution-title::before {
            content: "ğŸ’¡";
            margin-right: 8px;
        }
        
        .solution-steps {
            list-style: none;
            counter-reset: step-counter;
        }
        
        .solution-steps li {
            counter-increment: step-counter;
            margin-bottom: 12px;
            padding-left: 30px;
            position: relative;
        }
        
        .solution-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #007bff;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .error-details {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: #c53030;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #007bff;
            text-decoration: none;
            margin-top: 20px;
            font-weight: 500;
        }
        
        .back-link::before {
            content: "â†";
            margin-right: 8px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ iOS å®šä½é—®é¢˜è¯Šæ–­</h1>
            <p>å¸®åŠ©è§£å†³ CoreLocation å®šä½å¤±è´¥é—®é¢˜</p>
        </div>
        
        <div class="content">
            <div class="status-card">
                <h3 style="margin-bottom: 16px; color: #333;">ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
                <div class="status-item">
                    <span class="status-label">è®¾å¤‡ç±»å‹</span>
                    <span class="status-value status-info" id="deviceType">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æµè§ˆå™¨</span>
                    <span class="status-value status-info" id="browserType">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å®šä½APIæ”¯æŒ</span>
                    <span class="status-value" id="geolocationSupport">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">HTTPSç¯å¢ƒ</span>
                    <span class="status-value" id="httpsStatus">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å®šä½æƒé™</span>
                    <span class="status-value" id="permissionStatus">æ£€æµ‹ä¸­...</span>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-success" onclick="testLocation()">ğŸ¯ æµ‹è¯•å®šä½åŠŸèƒ½</button>
                <button class="btn btn-warning" onclick="showSolutions()">ğŸ’¡ æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ</button>
            </div>
            
            <div class="result-card" id="testResult">
                <div class="loading" id="testLoading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æµ‹è¯•å®šä½åŠŸèƒ½...</p>
                </div>
                <div id="testContent" style="display: none;"></div>
            </div>
            
            <div class="solution-card" id="solutionCard" style="display: none;">
                <div class="solution-title">å¸¸è§è§£å†³æ–¹æ¡ˆ</div>
                <ol class="solution-steps">
                    <li><strong>æ£€æŸ¥å®šä½æœåŠ¡æ€»å¼€å…³ï¼š</strong>è®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ å®šä½æœåŠ¡ï¼Œç¡®ä¿å·²å¼€å¯</li>
                    <li><strong>æ£€æŸ¥Safariå®šä½æƒé™ï¼š</strong>è®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ å®šä½æœåŠ¡ â†’ Safariæµè§ˆå™¨ï¼Œé€‰æ‹©"ä½¿ç”¨AppæœŸé—´"</li>
                    <li><strong>æ¸…é™¤ç½‘ç«™æ•°æ®ï¼š</strong>è®¾ç½® â†’ Safariæµè§ˆå™¨ â†’ é«˜çº§ â†’ ç½‘ç«™æ•°æ®ï¼Œæ‰¾åˆ°å¹¶åˆ é™¤ç›¸å…³ç½‘ç«™æ•°æ®</li>
                    <li><strong>é‡å¯å®šä½æœåŠ¡ï¼š</strong>å…³é—­å®šä½æœåŠ¡ç­‰å¾…10ç§’åé‡æ–°å¼€å¯</li>
                    <li><strong>ç½‘ç»œæ£€æŸ¥ï¼š</strong>ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå°è¯•åˆ‡æ¢WiFi/èœ‚çªç½‘ç»œ</li>
                    <li><strong>GPSä¿¡å·ï¼š</strong>åˆ°å¼€é˜”åŒºåŸŸé‡è¯•ï¼Œé¿å…å®¤å†…æˆ–é«˜æ¥¼å¯†é›†åŒºåŸŸ</li>
                    <li><strong>ç³»ç»Ÿé‡å¯ï¼š</strong>å¦‚æœä»¥ä¸Šéƒ½æ— æ•ˆï¼Œå°è¯•é‡å¯è®¾å¤‡</li>
                </ol>
            </div>
            
            <a href="/" class="back-link">è¿”å›å¤©æ°”å°é¸­ä¸»é¡µ</a>
        </div>
    </div>

    <script>
        // æ£€æµ‹è®¾å¤‡å’Œæµè§ˆå™¨ä¿¡æ¯
        function detectEnvironment() {
            const ua = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(ua);
            const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
            const isChrome = /Chrome/.test(ua);
            const isFirefox = /Firefox/.test(ua);
            
            // è®¾å¤‡ç±»å‹
            let deviceType = 'Unknown';
            if (/iPhone/.test(ua)) deviceType = 'iPhone';
            else if (/iPad/.test(ua)) deviceType = 'iPad';
            else if (/iPod/.test(ua)) deviceType = 'iPod';
            else if (/Android/.test(ua)) deviceType = 'Android';
            else deviceType = 'Desktop';
            
            document.getElementById('deviceType').textContent = deviceType;
            document.getElementById('deviceType').className = `status-value ${isIOS ? 'status-warning' : 'status-info'}`;
            
            // æµè§ˆå™¨ç±»å‹
            let browserType = 'Unknown';
            if (isSafari && !isChrome) browserType = 'Safari';
            else if (isChrome) browserType = 'Chrome';
            else if (isFirefox) browserType = 'Firefox';
            
            document.getElementById('browserType').textContent = browserType;
            document.getElementById('browserType').className = `status-value ${isSafari ? 'status-warning' : 'status-info'}`;
            
            // å®šä½APIæ”¯æŒ
            const hasGeolocation = !!navigator.geolocation;
            document.getElementById('geolocationSupport').textContent = hasGeolocation ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
            document.getElementById('geolocationSupport').className = `status-value ${hasGeolocation ? 'status-success' : 'status-error'}`;
            
            // HTTPSçŠ¶æ€
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';
            document.getElementById('httpsStatus').textContent = isSecure ? 'å®‰å…¨' : 'ä¸å®‰å…¨';
            document.getElementById('httpsStatus').className = `status-value ${isSecure ? 'status-success' : 'status-error'}`;
            
            // æƒé™çŠ¶æ€æ£€æŸ¥
            checkPermissionStatus();
        }
        
        async function checkPermissionStatus() {
            if ('permissions' in navigator) {
                try {
                    const result = await navigator.permissions.query({ name: 'geolocation' });
                    const status = result.state;
                    let statusText = status;
                    let statusClass = 'status-info';
                    
                    switch (status) {
                        case 'granted':
                            statusText = 'å·²æˆæƒ';
                            statusClass = 'status-success';
                            break;
                        case 'denied':
                            statusText = 'å·²æ‹’ç»';
                            statusClass = 'status-error';
                            break;
                        case 'prompt':
                            statusText = 'æœªè¯¢é—®';
                            statusClass = 'status-warning';
                            break;
                    }
                    
                    document.getElementById('permissionStatus').textContent = statusText;
                    document.getElementById('permissionStatus').className = `status-value ${statusClass}`;
                } catch (error) {
                    document.getElementById('permissionStatus').textContent = 'æ— æ³•æ£€æµ‹';
                    document.getElementById('permissionStatus').className = 'status-value status-warning';
                }
            } else {
                document.getElementById('permissionStatus').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('permissionStatus').className = 'status-value status-error';
            }
        }
        
        function testLocation() {
            const resultCard = document.getElementById('testResult');
            const loading = document.getElementById('testLoading');
            const content = document.getElementById('testContent');
            
            resultCard.classList.add('show');
            loading.style.display = 'block';
            content.style.display = 'none';
            
            const startTime = Date.now();
            
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 60000
            };
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    loading.style.display = 'none';
                    content.style.display = 'block';
                    content.innerHTML = `
                        <h4 style="color: #28a745; margin-bottom: 16px;">âœ… å®šä½æˆåŠŸï¼</h4>
                        <div class="status-item">
                            <span class="status-label">çº¬åº¦</span>
                            <span class="status-value status-success">${position.coords.latitude.toFixed(6)}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ç»åº¦</span>
                            <span class="status-value status-success">${position.coords.longitude.toFixed(6)}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ç²¾åº¦</span>
                            <span class="status-value status-info">${Math.round(position.coords.accuracy)}ç±³</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">è€—æ—¶</span>
                            <span class="status-value status-info">${duration}æ¯«ç§’</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æ—¶é—´æˆ³</span>
                            <span class="status-value status-info">${new Date(position.timestamp).toLocaleString()}</span>
                        </div>
                        <p style="margin-top: 16px; color: #28a745; font-weight: 500;">
                            ğŸ‰ å®šä½åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼æ‚¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å¤©æ°”å°é¸­çš„å®šä½åŠŸèƒ½ã€‚
                        </p>
                    `;
                },
                (error) => {
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    loading.style.display = 'none';
                    content.style.display = 'block';
                    
                    let errorMessage = '';
                    let errorCode = '';
                    let solution = '';
                    
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'ç”¨æˆ·æ‹’ç»äº†å®šä½è¯·æ±‚';
                            errorCode = 'PERMISSION_DENIED';
                            solution = 'è¯·åœ¨Safariè®¾ç½®ä¸­å…è®¸å®šä½æƒé™ï¼Œæˆ–ç‚¹å‡»åœ°å€æ çš„å®šä½å›¾æ ‡å…è®¸è®¿é—®ã€‚';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'ä½ç½®ä¿¡æ¯ä¸å¯ç”¨';
                            errorCode = 'POSITION_UNAVAILABLE';
                            solution = 'è¯·æ£€æŸ¥å®šä½æœåŠ¡æ˜¯å¦å¼€å¯ï¼Œæˆ–å°è¯•åˆ°å¼€é˜”åŒºåŸŸé‡è¯•ã€‚';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'å®šä½è¯·æ±‚è¶…æ—¶';
                            errorCode = 'TIMEOUT';
                            solution = 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒGPSä¿¡å·ï¼Œæˆ–å°è¯•å¢åŠ è¶…æ—¶æ—¶é—´ã€‚';
                            break;
                        default:
                            errorMessage = 'æœªçŸ¥å®šä½é”™è¯¯';
                            errorCode = 'UNKNOWN_ERROR';
                            solution = 'è¯·å°è¯•é‡å¯æµè§ˆå™¨æˆ–è®¾å¤‡ã€‚';
                    }
                    
                    content.innerHTML = `
                        <h4 style="color: #dc3545; margin-bottom: 16px;">âŒ å®šä½å¤±è´¥</h4>
                        <div class="status-item">
                            <span class="status-label">é”™è¯¯ç±»å‹</span>
                            <span class="status-value status-error">${errorMessage}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">é”™è¯¯ä»£ç </span>
                            <span class="status-value status-error">${errorCode}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">è€—æ—¶</span>
                            <span class="status-value status-info">${duration}æ¯«ç§’</span>
                        </div>
                        <div class="error-details">
                            <strong>è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š</strong><br>
                            ${error.message || 'æ— è¯¦ç»†ä¿¡æ¯'}
                        </div>
                        <div style="margin-top: 16px; padding: 12px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <strong>ğŸ’¡ å»ºè®®è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                            ${solution}
                        </div>
                    `;
                },
                options
            );
        }
        
        function showSolutions() {
            const solutionCard = document.getElementById('solutionCard');
            solutionCard.style.display = solutionCard.style.display === 'none' ? 'block' : 'none';
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æµ‹ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', detectEnvironment);
    </script>
</body>
</html>